### 1. 诊断逻辑重新设计

诊断将分为 “路由级区域重叠” 和 “语料级向量冲突” 两个维度：

#### A. 区域重叠 (Region Overlap)

- 定义：两个路由在嵌入空间中占据的“势力范围”存在显著交叠。这意味着即使没有完全相同的句子，由于它们描述的意图过于接近，模型也很容易产生误判。

- 采用指标：

- 质心相似度 (Centroid Similarity)：计算两个路由所有向量平均值的余弦相似度。

- 边界交叠度 (Boundary Overlap Score)：计算 Route A 的向量掉入 Route B 覆盖半径（score_threshold）内的比例。

- 阈值设置：

- 显著重叠：质心相似度 > 0.85 或 边界交叠度 > 20%。

- 严重冗余：质心相似度 > 0.95。

#### B. 向量冲突 (Instance Conflict)

- 定义：分属于两个不同路由的特定语料（句子），在语义空间中距离过近。

- 采用指标：

- 点对点余弦相似度 (Pairwise Similarity)：计算两个路由语料库之间两两句子的相似度。

- 阈值设置：

- 硬冲突：相似度 > 0.98（通常是意思完全一样或仅有标点差异）。

- 模糊歧义：相似度 > 0.92（表述方式不同但核心语义极度接近）。

------

### 2. 修复方案与页面设计

针对这两种情况，设计差异化的修复交互：

#### 场景一：区域重叠修复页面 (Route-level)

- 可视化呈现：使用 UMAP 降维图展示两个路由的“点云”交织情况。

- 操作选项：

- 合并意图：如果两个路由完全一致，支持一键合并为一个路由。

- 调整阈值：手动或自动微调 score_threshold，缩小冲突路由的响应半径。

#### 场景二：向量冲突修复页面 (Utterance-level)

- 可视化呈现：以列表形式左右对比展示冲突的句子对。

- *左侧 (Route A): "我想查余额"* ← (0.99) → *右侧 (Route B): "查询我的账户余额"*

- 操作选项：

- 删除 (Delete)：从 Route A 或 Route B 中删除冲突句。

- 修改 (Modify)：原地编辑句子，使其语义更偏向所属路由。

- 移动 (Move)：认为该句子归属错误，将其移至另一个路由。

- 设为负例 (Negative)：将对方的句子设为本路由的负例，强制模型区分。

------

### 3. 诊断触发时机

对于诊断触发时机：为了保证用户体验（不等待太久），只做两种触发：

实时/增量诊断：触发时机仅为路由保存时

全量诊断：触发时机为系统初次运行、手动点击深度体检时

注意：所有的诊断都应该与上述的触发时机操作异步进行，避免阻塞


修改页面逻辑：@intent-hub-frontend/src/views/Diagnostics.vue 
1、点击进入“分布图”标签页时，标签页切换组件会消失，无法重新进入到“列表”页
2、列表页：“视图”改为“冲突类型”，区域相似度要有计算值显示，向量冲突对要显示是与哪个路由的向量发生了冲突
3、点击开始扫描后，整个页面变成loading状态，全量更新，计算所有路由向量是否存在冲突，计算完后更新页面状态，不要让用户手动刷新页面
4、进入修复浮窗完成修改后点击重新检测的逻辑应该与上一条（3）相同，如果冲突解决了，退出浮窗；否则保持浮窗并更新浮窗内数据状态
5、“修复”浮窗内，语料冲突对比，两个类的颜色应该与点云图中的颜色一致
6、LLM数据增强不要自动触发，应该给用户手动选择是否触发
7、添加强化语句应该可以修改对应的语句
8、语料冲突对比池中，应该有可以点击新增语料句的功能
9、重新检测按钮应该和应用修复按钮在一起